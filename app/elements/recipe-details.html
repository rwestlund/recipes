<!--
    Randy Westlund
    2016-04
-->
<!-- This module allows editing of a recipe. -->

<link rel="import" href="../bc/polymer/polymer.html">

<dom-module id="recipe-details">
    <template>
        <style is="custom-style" include="global-styles"></style>
        <style>
            :host {
                display: block;
            }
        </style>

        <!-- AJAX requests. -->
        <iron-ajax auto
                method="GET"
                url="/recipes/[[recipeId]]"
                handle-as="json"
                last-response="{{recipe}}"
                on-error="loadingRecipeFailed"
                on-response="recipeReceived"
                loading="{{loading.getRecipe}}">
        </iron-ajax>

        <div class="headerbar layout horizontal center">
            <paper-button raised on-tap="loadRecipesPage">
                <iron-icon icon="icons:arrow-back"></iron-icon>
                All Recipes
            </paper-button>
        </div>

        <!-- The recipe card itself. --> 
        <paper-material>
            <div class="card-item">
                <div class="layout horizontal end end-justified wrap">
                    <h3 class="recipe-title">[[recipe.title]]</h3>
                    <!--<div class="layout horizontal end-justified">-->
                        <span class="flex"></span>
                        <span class="recipe-tags">
                            [[formatRecipeTags(recipe.tags)]]
                        </span>
                    <!--</div>-->
                </div>
                <div>[[recipe.summary]]</div>

                <div class="layout horizontal wrap">
                    <div class="flex-4 recipe-col">
                        <strong class="recipe-item-label">Ingredients</strong>
                        <ul class="ingredients-list">
                            <template is="dom-repeat"
                                    items="[[recipe.ingredients]]"
                                    as="i">
                                <li>[[i]]</li>
                            </template>
                        </ul>
                    </div>
                    <div class="flex-4 recipe-col">
                        <strong class="recipe-item-label">Directions</strong>
                        <ol class="directions-list">
                            <template is="dom-repeat"
                                    items="[[recipe.directions]]"
                                    as="d">
                                <li>[[d]]</li>
                            </template>
                        </ol>
                    </div>
                    <!-- Info column. -->
                    <div class="flex-4 recipe-col">
                        <template is="dom-if" if="[[recipe.amount]]">
                            <strong class="recipe-item-label">Amount</strong>
                            <div>[[recipe.amount]]</div>
                        </template>
                        <template is="dom-if" if="[[recipe.time]]">
                            <strong class="recipe-item-label">Time</strong>
                            <div>[[recipe.time]]</div>
                        </template>
                        <template is="dom-if" if="[[recipe.oven]]">
                            <Strong class="recipe-item-label">Oven</Strong>
                            <div>[[recipe.oven]]</div>
                        </template>
                        <strong class="recipe-item-label">Author</strong>
                        <div>[[recipe.author_name]]</div>
                        <template is="dom-if" if="[[recipe.source]]">
                            <strong class="recipe-item-label">Source</strong>
                            <div>[[recipe.source]]</div>
                        </template>
                        <strong class="recipe-item-label">Revision</strong>
                        <div>[[recipe.revision]]</div>
                        <template is="dom-if" if="[[recipe.notes]]">
                            <strong class="recipe-item-label">Notes</strong>
                            <div>[[recipe.notes]]</div>
                        </template>
                    </div>
                </div>
            </div>
        </paper-material>

    </template>

    <script>
        (function() {
            'use strict';
            Polymer({
                is: 'recipe-details',
                properties: {
                    recipeId: {
                        type: String,
                    },
                    loading: {
                        type: Object,
                        value: {
                            getRecipe: false,
                        },
                    },
                },
                ready: function() {
                },
                loadRecipesPage: function() {
                    page.show('/');
                },
                formatRecipeTags: function(tags) {
                    if (!tags) return "";
                    return tags.join(", ");
                },
            });
        })();
    </script>
</dom-module>
